function n(n,t){return jr(n+Math.random()*(t-n))}function t(n,t){for(var r=[],i=n;t>i;i++)r.push(i);return r}function r(n){return n}function i(n,t){if(!t||"object"!=typeof n)return n;var r=void 0!==n.length?[]:{};return f(n,function(n,e){r[e]=i(n,t-1)}),r}function e(n,t,r){return t>n?t:n>r?r:n}function u(){return Date.now()}function o(n,t){return n.replace(/X/g,t)}function c(n,t){return[].slice.call(n).map(t)}function f(n,t){for(var r in n)t(n[r],r)}function a(n,r,i,e,u){c(t(n,i),function(n){c(t(r,e),u.bind(0,n))})}function s(n){return Ir.querySelector("#"+n)}function l(n,t,r){var i={c:"class",s:"style",i:"id"},e="<"+n+" ";for(var u in t)e+=(i[u]||u)+"='"+t[u]+"'";return e+=">"+(r||"")+"</"+n+">"}function d(n,t){var r=s(n);return r.insertAdjacentHTML("beforeend",t),r.lastChild}function v(n,t){n.style.transform=t,n.style["-webkit-transform"]=t}function p(n,t){n.onclick=t,n.addEventListener("touchstart",function(n){return n.preventDefault(),t(n)})}function h(n,t){s(n).style.display=t?"block":"none"}function m(n){h(n,0)}function b(n){h(n,1)}function g(n,t,r){"string"==typeof n&&(n=s(n)),n.classList[r?"add":"remove"](t)}function y(n,t){t=t||r;var i,e=t(n[0]);return c(n,function(n){t(n)<=e&&(i=n,e=t(n))}),i}function w(n,t){return t=t||r,y(n,function(n){return-t(n)})}function T(n,t){var r=0;return c(n,function(n){r+=t(n)}),r}function k(n,t){return n&&n.indexOf(t)>=0}function x(n,t){var r=[];return c(n,function(i,e){c(n.slice(e+1),function(n){r.push(t(i,n))})}),r}function M(t){return c(t,function(r,i){var e=n(i,t.length),u=t[e];t[e]=t[i],t[i]=u}),t}function C(r){function i(t){var r=n(0,4);return r%2?t.w--:t.h--,2==r&&t.t++,3==r&&t.l++,t.w*t.h<9}function e(n){var t=!1;return a(n.l,n.t,n.l+n.w,n.t+n.h,function(n,r){t=t||s[n][r]}),t}function u(n,r){var i=r.l,e=r.t,u=r.w,f=r.h,l=[];c(t(0,u),function(n){l[n]=o(i+n,e),l[u+f+n]=o(i+u-n,e+f)}),c(t(0,f),function(n){l[u+n]=o(i+u,e+n),l[u+f+u+n]=o(i,e+f-n)});var d={i:n,p:l,d:[]};return a(r.l,r.t,r.l+r.w,r.t+r.h,function(n,t){s[n][t]=d}),d}function o(n,t){var r=6.28*zr(n*n*t*t*600+357*m),i=zr(n*t*600+211*m)/2;return[n+zr(r)*i,t+Er(r)*i]}function f(){a(1,1,nr-1,tr-1,function(n,t){var r=s[n][t];r&&(r.n||(r.n=[]),c([[-1,0],[1,0],[0,-1],[0,1]],function(i){var e=s[n+i[0]][t+i[1]];e&&e!=r&&-1==r.n.indexOf(e)&&r.n.push(e)}))})}var s,l,d,v,p=11-r,h=13+3*r,m=n(1e4,1e5);do for(s=t(0,nr).map(function(){return[]}),l=[],d=0,v=2500;h>d&&--v>0;){var b={l:n(1,nr-p+1),t:n(1,tr-p+1),w:n(3,p),h:n(3,p)};if(!d||e(b))for(;!i(b);)if(!e(b)){l.push(u(d++,b));break}}while(!v);return f(),l}function L(n){var t=0,r=0,i=n.length;return c(n,function(n){t+=n[0],r+=n[1]}),[t/i,r/i]}function H(n,t,r,i,e){var u=L(n);return c(n,function(n){return[u[0]+(n[0]-u[0])*t+i,u[1]+(n[1]-u[1])*r+e]})}function A(n){var t=n[0]/nr,r=n[1]/tr,i=.4*t+.6;return r=r*i+.5*(1-i),[100*t,100*r]}function S(n,t){return l("stop",{offset:n+"%",s:"stop-color:"+t})}function z(n,t,r){return l("radialGradient",{i:n,cx:"-100%",cy:"50%",fx:"-100%",fy:"50%",r:"200%",gradientUnits:"userSpaceOnUse"},S(60,r)+S(100,t))}function E(n,t,r,i,e){i=i||"stroke:#000;stroke-width:0.25;",r=r?"url(#"+r+")":"transparent";var u={i:t,points:c(n,A).join(" "),s:"fill:"+r+";"+i+";"};return e&&(u["clip-path"]=e),l("polygon",u)}function j(n,t){function r(){return c(u,function(n,t){return l("clipPath",{i:"clip"+t},E(n.p,"cp"+t,"l",""))}).join("")}function i(n,t,r,i,e,o,f,a){return l("g",{},c(u,function(u,c){return E(H(u.p,r,i,e,o),n+c,t,f,a?"url(#"+a+c+")":"")}).join(""))}function e(){f(t.t,function(n){var t=n.r.c,r="left:"+(t[0]-1.5)+"%;top:"+(t[1]-4)+"%",i=Nr({c:"o",s:r},Nr({c:"i"},Nr({c:"i"},Nr({c:"i"},Nr({c:"i"})))));n.e=d("m",i),p(n.e,X.bind(0,n.r,"t"))})}var u=t.r,o=l("defs",{},r()+z("b","#88f","#113")+z("l","#fa6","#530")+z("lh","#fb7","#741")+z("d","#210","#000")+z("w","#55f","#003")+c(t.p,function(n,t){return z("p"+t,n.l,n.d)+z("p"+t+"h",n.h,n.hd)}).join("")),a=E([[0,0],[nr,0],[nr,tr],[0,tr]],"b","b"),v=i("r","l",1,1,0,0),h=i("d","d",1,1,.05,.05),m=i("w","w",1.05,1.05,.2,.2," "),b=i("hl","",1,1,0,0,"stroke:#fff;stroke-width:1.5;opacity:0.0;","clip");n.innerHTML=l("svg",{viewbox:"0 0 100 100",preserveAspectRatio:"none"},o+a+m+h+v+b),qr={},c(u,function(n,t){n.e=s("r"+t),n.c=A(L(n.p)),n.hl=s("hl"+t),p(n.hl,X.bind(0,n,"c")),n.hl.oncontextmenu=ft.bind(0,n),n.e.oncontextmenu=ft.bind(0,n)}),p(Ir.body,X.bind(0,null,"c")),e()}function O(n){var t=Nr({i:"tc",c:"sc"});t+=Nr({i:"pd",c:"sc un"},c(n.p,function(n){var t=n.i;return Nr({i:"pl"+t,c:"pl",style:"background: "+n.d},n.n+Nr({c:"ad",i:"pr"+t})+Nr({c:"ad",i:"pc"+t}))}).join("")),t+=Nr({c:"sc un ds",i:"in"}),s("d").innerHTML=t,c(["mv","und"],b)}function X(n,t,r){var i=Dr[t];return i&&(Zt(Qr),i(n)),r.target.href&&"#"!=r.target.href?1:(r.stopPropagation(),0)}function I(n,t,r){function e(){t.d=i(f,3),t.d.h=t.r.filter(xt.bind(0,t,n)),q(t)}function u(r){var i=Ht(t,r.r),e=c(ar,function(e){var u=r.u==e?r.l+1:e==lr?t.m.h||0:0,c=e.c[u],f=o(e.n,sr[u])+l("b",{}," ("+c+"&#9775;)"),a=o(e.d,e.x[u]),s=!1;return s=s||e==mr&&!r.u,s=s||r.u&&r.u!=e&&e!=lr&&e!=mr,s=s||u>=e.c.length,s=s||u<St(t,i,e),s=s||i!=n,{t:f,d:a,o:c>At(t,n),h:s}});return e.push({t:"Done"}),e}var f={b:[{t:"Cancel move",h:1},{t:"End turn"}]};Dr.c=function(i){if(i&&t.d.t!=or||e(),!t.d.s&&i)xt(t,n,i)&&(e(),t.d.t=ur,t.d.s=i,t.d.c=Tt(t,i),t.d.b[0].h=0,t.d.h=i.n.concat(i));else if(i){var u=t.d;if(i==u.s)u.c=u.c%Tt(t,i)+1;else{if(u.s.n.indexOf(i)>-1)return Dr={},u.d=i,r(u);e()}}q(t)},Dr.t=function(n){var r=t.t[n.i];t.d={t:or,w:r,r:n,b:u(r)},q(t)},Dr.s=function(n){var r=null;c(t.r,function(i){k(t.s[i.i],n)&&(r=i)}),r&&Dr.c(r)},Dr.b=function(i){t.d&&t.d.t==or?i>=ar.length?e():(t.d.u=ar[i],t.d.u==lr&&(Fr[n.i]=t.d.r),r(t.d)):1==i?(Dr={},r({t:cr})):e()},Dr.un=function(){It(t)},e(),Fr[n.i]&&(Dr.t(Fr[n.i]),delete Fr[n.i])}function N(n,t){function r(){var n=Rr[0];n.f(),setTimeout(function(){Rr.shift(),Rr.length&&r()},n.d)}Rr.push({d:n,f:t}),1==Rr.length&&r()}function D(r){function i(t){var i=Ht(r,t),e=i?"p"+i.i:"l",u=k(r.d&&r.d.h||[],t)||r.e&&i==r.e;u&&(e+="h");var o=.1+.003*t.c[0];(r.e||r.d&&r.d.s==t)&&(o*=2),t.hl.style.opacity=u?o:0,t.hl.style.cursor=u?"pointer":"default",r.prt==t&&(r.prt=0,c(t.p,function(r){r=A(r);var i=t.c,e=n(30,100)/100,u=[Ut(e,i[0],r[0]),Ut(e,i[1],r[1])],o=(u[0]-i[0])/2,c=(u[1]-i[1])/2-.15;B(u[0],u[1],o,c,"#fff")})),t.e.style.fill="url(#"+e+")"}function e(){if(c(Ir.querySelectorAll(".ttp"),s("m").removeChild.bind(s("m"))),Lt(r).u==I){var n=r.d&&r.d.s;if(n){u(n,"Click this region again to change the number of soldiers.");var t=w(n.n,function(t){return Math.abs(n.c[0]-t.c[0])+Math.abs(n.c[1]-t.c[1])});u(t,"Click a bordering region to move.")}if(!n){var i=r.m.z;i&&(u(i[i.length-1],"Armies that conquer a new region cannot move again."),u({c:[-2,80]},"Once you're done, click 'End turn' here."))}2==r.m.t&&2==r.m.l&&u({c:[90,93]},"If you want to undo a move or check the rules, use the buttons here.",15)}}function u(n,t,r){if(!Jr.tt[t]){setTimeout(function(){Jr.tt[t]=1,Dt(Jr)},500),r=r||7;var i=n.c[0]-.5*(r+1),e=102-n.c[1],u="bottom: "+e+"%; left: "+i+"%; width: "+r+"%";d("m",Nr({c:"tt ttp",s:u},t))}}function o(n){for(var t=n.e,i=n.u?n.l+3:2;t;)t.style.display=i>0?"block":"none",t.style.background=n.u?n.u.b:"#999",i--,t=t.firstChild;var e=Ht(r,n.r);n.e.style.cursor=Wr==Hr?e==Lt(r)?"zoom-in":"help":"default";var u=r.d&&r.d.w==n;g(n.e,"l",u)}function a(n,t,i){h.push(t.i);var e=qr[t.i];if(!e){var u=Nr({c:"s",s:"display: none"});e=qr[t.i]=d("m",u),p(e,X.bind(0,t,"s"))}var o=n.c,c=Tt(r,n),f=y([c,4]),a=y([2/Or(c/4),1]),s=i%4,l=jr(i/4),v=-.6*f+1.2*s,m=l*a+(r.t[n.i]?1.5:0),b=o[0]+v-.2*m,w=o[1]+.2*v+m;if(t.a){var T=t.a.c;b=(b+T[0])/2,w=(w+T[1])/2}e.style.left=b+"%",e.style.top=w+"%",e.style.zIndex=20+5*l+s,e.style.display="block";var k=r.d||{};g(e,"l",k.s==n&&i<k.c)}function l(){c(r.flt||[],function(n){var t,r;if(n.r)t=n.r.c[0],r=n.r.c[1];else{var i=qr[n.s.i];t=parseFloat(i.style.left)+.2,r=parseFloat(i.style.top)+.2}t-=n.w/2+.5,r-=4;var e="left: "+t+"%;top:"+r+"%;color:"+n.c+";width:"+n.w+"%",u=d("m",Nr({c:"tt",s:e},n.t));v(u,"translate3d(0,0,0)"),U(u,0,-3)}),r.flt=0}c(r.r,i),f(r.t,o);var h=[];f(r.s,function(n,t){c(n,a.bind(0,r.r[t]))}),f(qr,function(r,i){if(h.indexOf(parseInt(i))<0){s("m").removeChild(r),delete qr[i];var e=parseFloat(r.style.left),u=parseFloat(r.style.top);c(t(0,20),function(){var t=6.28*Math.random(),r=n(0,100)/80;B(e+zr(t)*r,u+Er(t)*r,0,-1,"#000")})}}),l(),e()}function F(n){var t=n.m,r=n.d,i=r&&r.t==or,e=r&&r.s,u=Lt(n);if(i){var o=Ot(n,r.w);s("tc").innerHTML=Nr({},o.n)+Nr({c:"ds"},o.d)}else s("tc").innerHTML="Turn <b>"+n.m.t+"</b>"+(Jr.tc!=Mr?" / "+Jr.tc:"");c(n.p,function(t,r){var i=Mt(n,t),e=n.e;i?(s("pr"+r).innerHTML=Mt(n,t)+"&#9733;",s("pc"+r).innerHTML=e?e==t?"&#9819;":"":n.c[t.i]+"&#9775;"):(s("pr"+r).innerHTML="&#9760;",s("pc"+r).innerHTML="")});var o;o=u.u==I?i?Ht(n,r.r)==u?l("p",{},"Choose an upgrade to build."):"":e?l("p",{},"Click on this region again to choose how many to move.")+l("p",{},"Click on a target region to move the army."):l("p",{},"Click on a region to move or attack with its army.")+l("p",{},"Click on a temple to buy soldiers or upgrades with &#9775;."):l("p",{},u.n+" is taking her turn."),s("in").innerHTML=o,s("in").style.background=u.d,s("pd").style.display=i?"none":"block",s("mc").innerHTML=t.l+l("span",{s:"font-size: 80%"},"&#10138;"),s("ft").innerHTML=n.c[u.i]+l("span",{s:"font-size: 80%"},"&#9775;"),R(r&&r.b),s("und").innerHTML=Xt(n)?"&#x21b6;":""}function R(n){s("u").innerHTML="",c(n||[],function(n,t){if(!n.h){var r=Nr({},n.t);n.d&&(r+=Nr({c:"ds"},n.d));var i=l("a",{href:"#",c:n.o?"off":""},r),e=d("u",i);n.o||p(e,X.bind(0,t,"b"))}})}function q(n){Pr=n,D(n),F(n),n.sc&&(Zt(n.sc),n.sc=null)}function P(n,t,r){function i(n){return"translate3d(1.2em,"+n+"em,0) rotateY("+(10+2*n)+"deg)"}r=r||1,N(r,function(){var r=d("c",Nr({c:"bn"},t)),e=r.style;e.background=n,e.opacity=0,v(r,i(-1)),setTimeout(function(){e.opacity=1,v(r,i(1))},100),setTimeout(function(){e.opacity=1},600),setTimeout(function(){e.opacity=0},1100),setTimeout(function(){r.parentNode.removeChild(r)},1600)})}function B(n,t,r,i,e){var u="opacity:1;left: "+n+"%;top: "+t+"%;box-shadow: 0 0 1px 1px "+e,o=d("m",Nr({c:"pr",s:u},""));U(o,r,i)}function U(n,t,r){setTimeout(function(){v(n,"translate3d("+t+"em,"+r+"em,0)"),n.style.opacity=0},50),setTimeout(function(){s("m").removeChild(n)},3050)}function G(){setTimeout(function(){var n=Xr.innerWidth,t=Xr.innerHeight,r=1.65,i="px";n/t>r?n=t*r:t=n/r;var e=s("c").style;e.width=n+i,e.height=t+i,e.fontSize=.025*t+i},1)}function J(r){function e(n,t){for(var r=[{r:n,d:0}],i=[n],e=-1,u=100;0>e;){var o=r.shift(),f=o.r,a=o.d;f==t?e=a:a>=u?e=u:(f.d[t.i]&&(u=y([u,f.d[t.i]+a])),c(f.n,function(n){k(i,n)||r.push({r:n,d:a+1})}),i.push(f))}return n.d[t.i]=t.d[n.i]=e,e}function u(n){return y(x(n,e))}function o(){return l[n(0,l.length)]}function f(){function n(n){return c(f,function(t,r){return l[r]+e(t,n)})}function r(t){if(k(v,t))return-100;var r=n(t),i=w(r)-y(r),e=u(v.concat(f).concat(t));return e||(e=-5),e-i}c(s,function(n,t){d.c[t]=d.l[t]=0});var i=c(t(0,1e3),function(){return c(d.p,o)}),f=w(i,u);c(s,function(n,t){var r=f[t];d.o[r.i]=n,a(r,3)});var l=c(f,function(){return 0}),v=[],p=[3,3,4][s.length-2];c(t(0,p),function(){var t=w(d.r,function(n){return r(n)});a(t,3),v.push(t),l=n(t)})}function a(n,t){var r=n.i;d.t[r]={r:n,i:r},pt(d,n,t)}var s=[];c(r.p,function(t,r){if(t!=br){var e=i(fr[r],1);e.u=t==gr?I:W,t==yr&&(e.p=i(Sr[n(0,Sr.length)],2)),e.i=s.length,s.push(e)}});var l=C(s.length),d={p:s,r:l,o:{},t:{},s:{},c:{},l:{},m:{t:1,p:0,m:ur,l:rr}};return f(),d}function W(n,t,r){if(V(n,t)){var i=Z(n,t);return setTimeout(r.bind(0,i),ir)}var e=K(n,t);if(e)return setTimeout(r.bind(0,e),ir);var u=t.m.l||1;nt(n,t,u,r)}function V(n,t){if(!Ct(t,n).length)return!1;var r=n.p.u.length?n.p.s:1,i=jt(t)/t.c[n.i];if(i>1)return!1;var e=c(t.p,Y.bind(0,t)),u=w(e)/Y(t,n),o=u*r-i;return o>=0}function Y(n,t){return 2*Mt(n,t)+Et(n,t)}function K(n,t){if(n.p.u.length){var r=n.p.u[0],i=St(t,n,r);if(!(t.c[n.i]<r.c[i])){var e=Ct(t,n).filter(function(n){return!n.u&&!i||n.u==r});if(e.length){var u=y(e,Q.bind(0,t));return n.p.u.shift(),{t:or,u:r,w:u,r:u.r}}}}}function Q(n,t){var r=Ht(n,t.r);return ut(n,r,t.r)+ot(n,r,t.r)}function Z(n,t){var r=w(Ct(t,n),Q.bind(0,t));return{t:or,u:lr,w:r,r:r.r}}function $(n){if(0==n.d)return n.v=it(n.a,n.s),_(n.p,n);var t=n.u.shift();if(t){var r=st(n.s,t);return{p:n,a:n.a,d:n.d-1,m:t,s:r,u:tt(r)}}return _(n.p,n)}function _(n,t){if(n){var r=n.s.p[n.s.m.p],i=r==n.a,e=!n.b||i&&t.v>n.v||!i&&t.v<n;e&&(n.b=t.m,n.v=t.v)}return n}function nt(n,t,r,i){function e(){for(var n=a;n--;){f=$(f);var t=u()-s;if(t>er&&(f=null,console.log("Maximum thinking time elapsed!")),!f){var r=c.b;return r||(r={t:cr}),void setTimeout(i.bind(0,r),w([ir-t,1]))}}setTimeout(e,1)}var o=lt(t,n),c={p:null,a:n,s:o,d:r,u:tt(t)},f=c,a=100,s=u();setTimeout(e,1)}function tt(n){function t(t,e,u){Ht(n,e)!=i&&Tt(n,e)>u||r.push({t:ur,s:t,d:e,c:u})}var r=[{t:cr}],i=Lt(n);return n.m.l?(c(n.r,function(r){if(xt(n,i,r)){var e=Tt(n,r);c(r.n,function(n){t(r,n,e),e>1&&t(r,n,jr(e/2))})}}),M(r),r):r}function rt(n,t,r,i){var e=i*Jr.tc,u=(n.m.t-e)/(Jr.tc-e);return 0>u&&(u=0),t+(r-t)*u}function it(n,t){function r(r){var u=et(t,r);return u+=ot(t,n,r)*e-ut(t,n,r)*e*u,u+=Tt(t,r)*i}var i=rt(t,.25,0,.83),e=rt(t,1,0,.83),u=T(t.r,function(i){return Ht(t,i)==n?r(i):0}),o=kt(t,n)*i/12;return u+o}function et(n,t){var r=n.t[t.i];if(r){var i=rt(n,6,0,.5),e=rt(n,4,0,.9),u=r.u?r.l+1:0;return 1+i+e*u}return 1}function ut(n,t,r){var i=Jr.l;if(Jr.l==wr)return 0;var u=Tt(n,r),o=w(c(r.n,function(r){var e=Ht(n,r);if(e==t||!e)return 0;for(var u=i==Tr?0:2,o=[{r:r,d:u}],f=[],a=0;o.length;){var s=o.shift();a+=Tt(n,s.r)*(i>Tr?(2+s.d)/4:1),f.push(s.r),s.d&&c(s.r.n.filter(function(t){return!k(f,t)&&Ht(n,t)==e}),function(n){o.push({r:n,d:s.d-1})})}return a}));return e((o/(u+1e-4)-1)/1.5,0,i==Tr?.5:1.1)}function ot(n,t,r){if(Jr.l==wr)return 0;var i=Tt(n,r);return i?T(r.n,function(r){if(Ht(n,r)!=t){var u=Tt(n,r);return e(.5*(i/(u+.01)-.9),0,.5)*et(n,r)}return 0}):0}function ct(){c(Pr.p,function(n,t){Pr.c[t]+=500}),q(Pr)}function ft(n){var t=Ht(Pr,n);return console.log("THREAT:"+ut(Pr,t,n)),console.log("VALUE:"+et(Pr,n)),!1}function at(n,t,r){return Mt(t,n)?void n.u(n,t,r):r({t:cr})}function st(n,t){n=lt(n);var r=t.t;return r==ur?ht(n,t.s,t.d,t.c):r==or?bt(n,t.r,t.u):r==cr&&gt(n),vt(n),n}function lt(n,t){return{r:n.r,p:n.p,a:n.a||t,m:i(n.m,1),o:i(n.o,1),t:i(n.t,2),s:i(n.s,3),c:i(n.c,1),l:i(n.l,1),flt:n.flt}}function dt(n){Wr=Hr,N(150,function(){var t=Lt(n);at(t,n,function(r){t.u==W&&Zt(Qr);var i=st(n,r);return i.e?(N(150,q.bind(0,i)),void wt(i)):(Ur=lt(n),void setTimeout(dt.bind(0,i),1))}),q(n)})}function vt(n){c(n.p,function(t){var r=T(n.r,function(r){return Ht(n,r)==t?Tt(n,r):0});!r&&Mt(n,t)&&(f(n.o,function(r,i){t==r&&delete n.o[i]}),Lt(n)==t&&(n.m.l=0),n.a||(N(150,q.bind(0,n)),P("#222",t.n+" has been eliminated!",900)))});var t=n.p.filter(Mt.bind(0,n)).length>1;return t?void 0:void(n.e=yt(n))}function pt(n,r,i){c(t(0,i),function(){Br=Br+1||0;var t=n.s[r.i];t||(t=n.s[r.i]=[]),t.push({i:Br++})})}function ht(r,i,e,u){function o(t){var i=120+g;return r.a?(t+3)*i/(b+5):n(.12*i,.88*i)}var f=r.s[i.i],a=r.s[e.i]||(r.s[e.i]=[]),s=Ht(r,i),l=Ht(r,e);if(s!=l){var d=a.length,v=y([u,zt(r,l,hr)]),p=zt(r,s,vr);if((v||d)&&(r.a||c(f.slice(0,u),function(n){n.a=e}),mt(r)),v&&(c(t(0,v),function(){f.shift(),u--}),mt(r,1500,$r,[{s:f[0],t:"Earth kills "+v+"!",c:hr.b,w:9}])),d&&u){r.u=1;var h=u*(1+.01*zt(r,s,vr)),m=d*(1+.01*zt(r,l,hr)),b=y([u,d]),g=100*Math.pow(h/m,1.6);c(t(0,b),function(n){o(n)<=120?p--<=0?(f.shift(),u--,mt(r,250,$r)):mt(r,800,$r,[{s:f[0],t:"Protected by Fire!",c:vr.b,w:11}]):(a.shift(),l&&(r.c[l.i]+=4),mt(r,250,Zr))}),a.length&&(u=0,r.sc=ni,r.flt=[{r:e,c:l?l.h:"#fff",t:"Defended!",w:7}])}c(f,function(n){n.a=0})}if(u>0&&(c(t(0,u),function(){a.push(f.shift())}),s!=l)){r.o[e.i]=s,r.m.z=(r.m.z||[]).concat(e);var w=r.t[e.i];w&&delete w.u,r.prt=e,r.flt=[{r:e,c:s.h,t:"Conquered!",w:7}],r.sc=d?_r:ti}r.m.l--}function mt(n,t,r,i){if(!n.a){var e=lt(n);e.sc=r,e.flt=i,N(t||500,q.bind(0,e))}}function bt(n,t,r){var i=n.t[t.i],e=Ht(n,t);return r==lr?(n.m.h||(n.m.h=0),n.c[e.i]-=r.c[n.m.h++],pt(n,t,1)):r==mr?void delete i.u:(i.u!=r?(i.u=r,i.l=0):i.l++,n.c[e.i]-=r.c[i.l],n.prt=i.r,void(r==pr&&n.m.l++))}function gt(n){var t=Lt(n),r=kt(n,t);n.c[t.i]+=r,r&&(n.flt=[{r:Ct(n,t)[0].r,t:"+"+r+"&#9775;",c:"#fff",w:5}]),f(n.t,function(r,i){n.o[i]==t&&pt(n,r.r,1)});do{var i=n.p.length,e=(n.m.p+1)%i,u=n.p[e],o=n.m.t+(e?0:1);n.m={t:o,p:e,m:ur,l:rr+zt(n,u,pr)}}while(!Mt(n,u));return n.m.t>Jr.tc?(n.m.t=Jr.tc,void(n.e=yt(n))):void(n.a||P(Lt(n).d,Lt(n).n+"'s turn"))}function yt(n){var t=Mt.bind(0,n),r=w(n.p,t),i=n.p.filter(function(n){return n!=r}),e=w(i,t);return t(r)!=t(e)?r:Ar}function wt(n){N(1,function(){var t=n.e;t!=Ar?P(t.d,t.n+" wins the game!"):P("#333","The game ends in a draw!"),q(n),s("tc").innerHTML="Game complete",s("in").innerHTML=l("p",{},"Click the button below to start a new game."),s("in").style.background="#555",s("mv").style.display="none",R([{t:"New game"}]),Dr.b=Rt})}function Tt(n,t){var r=n.s[t.i];return r?r.length:0}function kt(n,t){var r=Ct(n,t);if(!r.length)return 0;var i=Mt(n,t),e=T(r,function(t){return Tt(n,t.r)}),u=1+.01*zt(n,t,dr);return t.u==W&&Jr.l==xr&&(u+=.4),Or(u*(i+e))}function xt(n,t,r){return n.m.l>0&&Ht(n,r)==t&&Tt(n,r)&&!k(n.m.z,r)}function Mt(n,t){var r=0;return c(n.r,function(i){Ht(n,i)==t&&r++}),r}function Ct(n,t){var r=[];return f(n.t,function(i,e){n.o[e]==t&&r.push(i)}),r}function Lt(n){return n.p[n.m.p]}function Ht(n,t){return n.o[t.i]}function At(n,t){return n.c[t.i]}function St(n,t,r){return w(c(Ct(n,t),function(n){return n.u&&n.u==r?n.l+1:0}).concat(0))}function zt(n,t,r){return t?w(c(n.r,function(i){var e=n.t[i.i];return e?Ht(n,i)!=t?0:e.u==r?r.x[e.l]:0:0})):0}function Et(n,t){return T(n.r,function(r){return Ht(n,r)==t?Tt(n,r):0})}function jt(n){return lr.c[n.m.h||0]}function Ot(n,t){if(t.u){var r=t.u,i=t.l,e=o(r.d,r.x[i]);return{n:o(r.n,sr[i]),d:e}}var u=Ht(n,t.r)?"Basic Temple":"Neutral Temple";return{n:u,d:"No upgrades."}}function Xt(n){return Ur&&Lt(Ur)==Lt(n)&&!n.u&&Lt(n).u==I}function It(n){if(Xt(n)){Dr={};var t=Ur;Ur=null,dt(t)}}function Nt(){if(localStorage){var n=localStorage.getItem("s");if(n)return n=JSON.parse(n),f(Gr,function(t,r){void 0===n[r]&&(n[r]=t)}),n}return Gr}function Dt(){localStorage&&localStorage.setItem("s",JSON.stringify(Jr))}function Ft(){function n(n,t,r,i){var e=c(r,function(n,i){var e=t+(r.length-1-i);return l("a",{i:e,c:"rt",href:"#",s:"font-size: 90%"},n)}).join(""),u={c:"sc ds",s:"padding-right: 0.5em"};return f(i,function(n,t){u[t]=n}),Nr(u,n+e)}var r=Nr({c:"sc ds"},"Player setup"),i=c(fr,function(t){var r=t.i;return n(t.n,"sb"+t.i,["AI","Human","Off"],{i:"pl"+r,c:"pl",s:"background: "+t.d})}).join("");r+=Nr({i:"pd",c:"sc un"},i),r+=n("AI","ai",["Evil","Mean","Rude","Nice"]),r+=n("Turns","tc",["Endless","15","12","9"]),s("d").innerHTML=r,c(["mv","und"],m),a(0,0,fr.length,3,function(n,t){p(s("sb"+n+t),X.bind(0,{p:n,b:t},"sb"))}),c(t(0,4),function(n){p(s("ai"+n),X.bind(0,n,"ai")),p(s("tc"+n),X.bind(0,Cr[n],"tc"))})}function Rt(){function n(){var n=T(Jr.p,function(n){return n!=br?1:0});return n>1}function r(){var t=!n();R([{t:"Change map",o:t},{t:"Start game",o:t}])}function i(){Dt(Jr),c(Jr.p,function(n,r){c(t(0,3),function(t){g("sb"+r+t,"sl",n==t)})}),c(t(0,4),function(n){g("ai"+n,"sl",n==Jr.l),g("tc"+n,"sl",Cr[n]==Jr.tc)})}function e(){n()&&(u=J(Jr),j(s("m"),u),D(u))}Wr=Lr;var u;e(),Ft(),r(),i(),Dr.b=function(t){n()&&(0==t?e():(O(u),q(u),dt(u)))},Dr.sb=function(n){Jr.p[n.p]=n.b,i(),r(),e()},Dr.ai=function(n){Jr.l=n,i()},Dr.tc=function(n){Jr.tc=n,i()}}function qt(){c(["o","tub","snd"],function(n){h(n,1)}),p(s("cb"),Bt.bind(0,!1)),p(s("nxt"),Pt.bind(0,1)),p(s("prv"),Pt.bind(0,-1)),p(s("tub"),Bt.bind(0,!0)),p(s("snd"),_t),p(s("und"),X.bind(0,0,"un")),Pt(0),setTimeout(Bt.bind(0,!0),10)}function Pt(n){Vr=e(Vr+n,0,Yr-1),v(s("tuc"),"translate3d("+100*-Vr/Yr+"%,0,0)"),h("prv",Vr>0),h("nxt",Yr-1>Vr)}function Bt(n){n&&(s("ts").style.display="block"),setTimeout(function(){g("ts","h",!n)},50),n||setTimeout(function(){s("ts").style.display="none"},500)}function Ut(n,t,r){return n=e(n,0,1),r*n+t*(1-n)}function Gt(n,t,r,i,e,u){var o=0;return function(c){var f=u(c);return o+=c,n>o?Ut(o/n,0,1)*f:n+t>o?Ut((o-n)/t,1,e)*f:n+t+r>o?e*f:Ut((o-n-r-t)/i,e,0)*f}}function Jt(n){var t=0;return function(r){return t+=r,Math.sin(t*n*6.283)}}function Wt(n,t,r,i){var e=0;return function(u){e+=u;var o=u*Ut(e/r,n,t);return i(o)}}function Vt(n,t,r,i){var e=0;return function(u){return e+=u,i(e>r?u*t:u*n)}}function Yt(n){c(n,function(n){n.f=Gt(.01,.03,.03*n.d,.03*n.d,.7,Jt(n.p))});var t=0;return function(r){t+=r;var i=0;return c(n,function(n){t>=n.t&&(i+=n.f(r))}),i}}function Kt(n,t,r){for(var r=r||1,i=Kr.sampleRate,e=i*t,u=Kr.createBuffer(1,e,i),o=1/i,c=u.getChannelData(0),f=0;e>f;f++)c[f]=n(o)*r;return u}function Qt(){Kr&&(Qr=Kt(Gt(.01,.03,.01,.01,.2,Jt(110)),.1),Zr=Kt(Gt(.01,.05,.05,.05,.5,Wt(1,.3,.1,Jt(300))),.2,.6),$r=Kt(Gt(.01,.05,.05,.05,.5,Wt(1,.3,.1,Jt(200))),.2,.6),ti=Kt(Yt([{t:0,p:261,d:1},{t:.1,p:329,d:2}]),.6,.2),_r=Kt(Yt([{t:0,p:261,d:1},{t:0,p:329,d:2},{t:0,p:392,d:3},{t:.2,p:261,d:1},{t:.2,p:349,d:2},{t:.2,p:440,d:3}]),.6,.2),ni=Kt(Yt([{t:0,p:392,d:3},{t:.15,p:329,d:2},{t:.3,p:261,d:1}]),.6,.2),$t())}function Zt(n){if(n&&Jr.s){var t=Kr.createBufferSource();t.buffer=n,t.connect(Kr.destination),t.start()}}function $t(){s("snd").innerHTML=Jr.s?"♪":" ",Dt(Jr)}function _t(){Jr.s=!Jr.s,$t()}var nr=30,tr=20,rr=3,ir=1e3,er=5e3,ur=1,or=2,cr=3,fr=[{i:0,n:"Amber",l:"#fd8",d:"#960",h:"#fd8",hd:"#a80"},{i:1,n:"Crimson",l:"#f88",d:"#722",h:"#faa",hd:"#944"},{i:2,n:"Lavender",l:"#d9d",d:"#537",h:"#faf",hd:"#759"},{i:3,n:"Emerald",l:"#9d9",d:"#262",h:"#bfb",hd:"#484"}],ar=[{n:"Extra soldier",d:"",c:c(t(0,100),function(n){return 8+4*n}),x:[]},{n:"X of Water",d:"Income: X% more each turn.",c:[15,25],x:[20,40],b:"#66f"},{n:"X of Fire",d:"Attack: X invincible soldier(s).",c:[20,30],x:[1,2],b:"#f88"},{n:"X of Air",d:"Move: X extra move(s) per turn.",c:[25,35],x:[1,2],b:"#ffa"},{n:"X of Earth",d:"Defense: Always kill X invader(s).",c:[30,45],x:[1,2],b:"#696"},{n:"Rebuild temple",d:"Switch to a different upgrade.",c:[0],x:[]}],sr=["Temple","Cathedral"],lr=ar[0],dr=ar[1],vr=ar[2],pr=ar[3],hr=ar[4],mr=ar[5],br=0,gr=1,yr=2,wr=0,Tr=1,kr=2,xr=3,Mr=1e6,Cr=[9,12,15,Mr],Lr=0,Hr=1,Ar={},Sr=[{s:1,u:[]},{s:.2,u:[dr,hr]},{s:.25,u:[dr,vr,vr]},{s:.15,u:[dr,dr,hr,hr]},{s:.4,u:[dr]},{s:.3,u:[dr,dr]},{s:.25,u:[vr,vr]},{s:.2,u:[hr,hr]}],zr=Math.sin,Er=Math.cos,jr=Math.floor,Or=Math.ceil,Xr=window,Ir=document,Nr=l.bind(0,"div"),Dr={},Fr={},Rr=[],qr={},Pr,Br,Ur=null,Gr={p:[gr,yr,yr,br],l:wr,s:!0,tc:12,tt:{}},Jr=Nt(),Wr=0,Vr=0,Yr=5,Kr=window.AudioContext&&new AudioContext,Qr,Zr,$r,_r,ni,ti;(Xr.onresize=G)(),window.onload=function(){setTimeout(function(){Jr=Nt(),Qt(),Rt(),qt()},500)};